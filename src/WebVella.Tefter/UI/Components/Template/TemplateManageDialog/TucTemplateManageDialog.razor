@namespace WebVella.Tefter.UI.Components
@inherits TfFormBaseComponent
@* Header *@
<FluentDialogHeader ShowDismiss="true">
	<FluentLabel Typo="Typography.PaneHeader">@_title</FluentLabel>
</FluentDialogHeader>

@* Footer *@
<FluentDialogFooter>
	@if (String.IsNullOrWhiteSpace(_error))
	{
		<FluentButton Appearance="Appearance.Accent" OnClick="@_save" IconStart="_iconBtn"
		              Loading="_isSubmitting" Disabled="_isSubmitting">@_btnText</FluentButton>
	}
	<FluentButton Appearance="Appearance.Neutral" OnClick="@_cancel">@LOC("Cancel")</FluentButton>
</FluentDialogFooter>

@* Body *@
<FluentDialogBody>
	@if (!string.IsNullOrWhiteSpace(_error))
	{
		<FluentMessageBar Intent="@MessageIntent.Error" AllowDismiss="false">@_error</FluentMessageBar>
	}
	else
	{
		<FluentEditForm EditContext="EditContext" OnValidSubmit="_save"
		                FormName="submit-form" class="tf-form" novalidate>
			<DataAnnotationsValidator/>
			<FluentGrid>
				<FluentGridItem xs="6">
					<FluentInputLabel Label="@LOC("Status")"/>
					<FluentSwitch @bind-Value=@_form.IsEnabled>
						<span slot="checked-message">@LOC("enabled")</span>
						<span slot="unchecked-message">@LOC("enabled")</span>
					</FluentSwitch>
					<FluentValidationMessage For="@(() => _form.IsEnabled)"/>
				</FluentGridItem>
				<FluentGridItem xs="6">
					<FluentInputLabel Label="@LOC("Selectable by Users")"/>
					<FluentSwitch @bind-Value=@_form.IsSelectable>
						<span slot="checked-message">@LOC("selectable")</span>
						<span slot="unchecked-message">@LOC("selectable")</span>
					</FluentSwitch>
					<FluentValidationMessage For="@(() => _form.IsSelectable)"/>
				</FluentGridItem>
			</FluentGrid>
			<FluentGrid>
				<FluentGridItem xs="6">
					<FluentTextField Required="true" TextFieldType="@TextFieldType.Text"
					                 @bind-Value=@_form.Name AutoComplete="off"
					                 Label="@LOC("Name")" Style="width:100%"/>
					<FluentValidationMessage For="@(() => _form.Name)"/>
				</FluentGridItem>
				<FluentGridItem xs="6">
					<FluentInputLabel Label="@LOC("Icon")"/>
					<TucSelectIcon @bind-Value="@_form.FluentIconName" Required="true"/>
					<FluentValidationMessage For="@(() => _form.FluentIconName)"/>
				</FluentGridItem>
			</FluentGrid>
			<FluentGrid>
				<FluentGridItem xs="12">
					<FluentTextField @bind-Value=@_form.Description
					                 Label="@LOC("Description")" Style="width:100%"/>
					<FluentValidationMessage For="@(() => _form.Name)"/>
				</FluentGridItem>
			</FluentGrid>
			<FluentGrid>
				<FluentGridItem xs="6">
					<TucSelect TOption="TfColumnNamePreprocessType"
					           Items="@(Enum.GetValues<TfColumnNamePreprocessType>())"
					           SelectedOption="_form.ColumnNamePreprocess"
					           SelectedOptionChanged="@((x)=> _form.ColumnNamePreprocess = x)"
					           OptionText="@((x) => x.ToDescriptionString())"
					           OptionValue="@((x) => ((int)x).ToString())"
					           Label="@LOC("Column name preprocessing")" Style="width:100%"/>
					<FluentValidationMessage For="@(() => _form.ColumnNamePreprocess)"/>
				</FluentGridItem>
			</FluentGrid>			
			<FluentGrid>
				<FluentGridItem xs="12">
					<FluentInputLabel>
						<span>@LOC("Required columns")</span>
						@if (_form.ColumnNamePreprocess == TfColumnNamePreprocessType.RemoveProviderPrefix)
						{

							<span style="margin-left:5px;">(@LOC("without provider prefix"))</span>
						}
					</FluentInputLabel>
					<FluentStack>
						<TucSelectList @bind-Values=@_form.RequiredColumnsList Placeholder="@LOC("type a column name + ENTER")"
						               NoItemsMessage="@LOC("no required columns submitted")"/>
					</FluentStack>
					<FluentValidationMessage For="@(() => _form.RequiredColumnsList)" />
				</FluentGridItem>
			</FluentGrid>			
			@if (_isCreate)
			{
				<FluentDivider Style="margin:15px 0"/>
				<FluentGrid>
					<FluentGridItem xs="12">
						<FluentInputLabel Label="@LOC("Template type")"/>
						<TucSelectComponent TOption="ITfTemplateProcessorAddon" Items="@_processors"
						                    Value="_selectedProcessor" ValueChanged="_componentChanged"
						                    OptionText="@(x => x.Name)" OptionIcon="@(x => x.FluentIconName)"
						                    OptionDescription="@(x => x.Description)"
						                    OptionMatch="@((x, y) => x.Id == y.Id)"/>
					</FluentGridItem>
				</FluentGrid>
			}
		</FluentEditForm>
	}
</FluentDialogBody>
