@namespace WebVella.Tefter.Web.Components
@inherits TfBaseComponent
@{
	var columnCount = 0;
}
@if (TfAppState.Value.AdminDataProviderData is not null)
{
	<div class="tfdt" style="margin-top:1rem">
		<div class="tfdt__toolbar" style="display:flex;justify-content:space-between;">
			<div style="flex:1 1 auto">
				<FluentStack>
					<FluentSearch Value="@TfAppState.Value.AdminDataProviderDataSearch" ValueChanged="_onSearch" AutoComplete="off" Placeholder="@LOC("search...")" />
					<FluentButton Id="view-filter-selector" Title="toggle system columns" OnClick="_toggleSystemColumns"
								  Appearance="Appearance.Outline">
						<FluentIcon Slot="start" Value="@(_showSystemColumns ? TfConstants.GetIcon("Checkmark").WithColor(Color.Success) : TfConstants.GetIcon("Dismiss").WithColor(Color.Error))" />
						<span>system</span>
						<span slot="end">
							<FluentBadge Appearance="Appearance.Neutral">@TfAppState.Value.AdminDataProvider.SystemColumns.Count</FluentBadge>
						</span>
					</FluentButton>
					<FluentButton Id="view-filter-selector" Title="toggle shared key columns" OnClick="_toggleSharedKeyColumns"
								  Appearance="Appearance.Outline">
						<FluentIcon Slot="start" Value="@(_showSharedKeyColumns ? TfConstants.GetIcon("Checkmark").WithColor(Color.Success) : TfConstants.GetIcon("Dismiss").WithColor(Color.Error))" />
						<span>shared key</span>
						<span slot="end">
							<FluentBadge Appearance="Appearance.Neutral">@TfAppState.Value.AdminDataProvider.SharedColumns.Count</FluentBadge>
						</span>
					</FluentButton>
					<FluentButton Id="view-filter-selector" Title="toggle custom columns" OnClick="_toggleCustomColumns"
								  Appearance="@Appearance.Outline">
						<FluentIcon Slot="start" Value="@(_showCustomColumns ? TfConstants.GetIcon("Checkmark").WithColor(Color.Success) : TfConstants.GetIcon("Dismiss").WithColor(Color.Error))" />
						<span>custom</span>
						<span slot="end">
							<FluentBadge Appearance="Appearance.Neutral">@TfAppState.Value.AdminDataProvider.Columns.Count</FluentBadge>
						</span>
					</FluentButton>
				</FluentStack>
			</div>
			<div style="flex:0 0 auto">
				<FluentButton OnClick="_deleteAllData" Appearance="@Appearance.Outline">
					<FluentIcon Value="@TfConstants.DeleteIcon" Slot="start" Color="@Color.Error" />
					@LOC("delete all data")
				</FluentButton>
			</div>
		</div>
		@if (TfAppState.Value.AdminDataProviderData.Rows.Count > 0 || TfAppState.Value.AdminDataProviderDataPage != 1)
		{
			<div class="tfdt__content">
				<div class="tf-grid-wrapper">
					<table class="tf-grid">
						<thead class="tf-grid-thead">
							<tr class="tf-grid-thead-bkg" style="@($"background-color: {TfConstants.AdminBackgkroundColor}")"></tr>
							<tr class="tf-grid-tr">
								@foreach (var column in TfAppState.Value.AdminDataProviderData.Columns)
								{
									if (!_columnIsVisible(column)) { continue; }
									<th class="tf-grid-th">@column.Name</th>
									columnCount++;
								}
							</tr>
						</thead>
						<tbody class="tf-grid-tbody">
							@if (_isDataLoading)
							{
								<tr class="tf-grid-tr">
									<td class="tf-grid-td" colspan="@columnCount"><div>Loading...</div></td>
								</tr>
							}
							else
							{
								foreach (TfDataRow row in TfAppState.Value.AdminDataProviderData.Rows)
								{
									<tr @key=@row["tf_id"] class="tf-grid-tr">
										@foreach (var column in TfAppState.Value.AdminDataProviderData.Columns)
										{
											if (!_columnIsVisible(column)) { continue; }
											<td class="tf-grid-td">
												<div>@row[column.Name]</div>
											</td>
										}
									</tr>
								}
								@if (TfAppState.Value.AdminDataProviderData.Rows.Count == 0)
								{
									<tr class="tf-grid-tr">
										<td class="tf-grid-td" colspan="@columnCount">No records found</td>
									</tr>
								}
							}
						</tbody>
					</table>

				</div>
			</div>
			<div class="tfdt__pager">
				<TfPager Page="@TfAppState.Value.AdminDataProviderDataPage" GoLast="@_goLastPage" GoNext="@_goNextPage"
						 GoFirst="@_goFirstPage" GoPrevious="@_goPreviousPage" GoOnPage="@_goOnPage"
						 PageSize="@TfAppState.Value.AdminDataProviderDataPageSize" ChangePageSize="_pageSizeChange" />
			</div>
		}
		else if (TfAppState.Value.AdminDataProviderData.Columns.Count == 0)
		{
			<div class="tfdt__content">
				<FluentMessageBar AllowDismiss="false">@LOC("No columns are created for this data provider yet")</FluentMessageBar>
			</div>
		}
		else
		{
			<div class="tfdt__content">
				<FluentMessageBar AllowDismiss="false">@LOC("No records")</FluentMessageBar>
			</div>
		}
	</div>
}



