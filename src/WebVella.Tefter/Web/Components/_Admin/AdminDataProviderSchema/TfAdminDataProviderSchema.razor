@namespace WebVella.Tefter.Web.Components
@inherits TfBaseComponent

@if (TfAppState.Value.AdminManagedDataProvider is null || TfAppState.Value.AdminManagedDataProvider.Columns is null
		|| TfAppState.Value.AdminManagedDataProvider.Columns.Count == 0)
{
	<FluentMessageBar Title="@LOC("No columns")" AllowDismiss="false"
					  Intent="@MessageIntent.Info">@LOC("No columns are created yet for this data source")</FluentMessageBar>
}
else
{
	<div class="tf-grid-wrapper">
		<table class="tf-grid">
			<thead class="tf-grid-thead">
				<tr class="tf-grid-thead-bkg" style="@($"background-color:{TfConstants.AdminBackgkroundColor}")"></tr>
				<tr class="tf-grid-tr">
					<th class="tf-grid-th" style="width:50px;"></th>
					<th class="tf-grid-th">name</th>
					<th class="tf-grid-th">type</th>
					<th class="tf-grid-th" style="width:120px;">created on</th>
					<th class="tf-grid-th">details</th>
				</tr>
			</thead>
			<tbody class="tf-grid-tbody">
				@foreach (var context in TfAppState.Value.AdminManagedDataProvider.Columns.OrderBy(x=> x.DbName))
				{
					<tr @key=context.Id class="tf-grid-tr">
						<td class="tf-grid-td">
							<div>
								<FluentButton Appearance="@Appearance.Outline" IconStart="@TfConstants.EditIcon" 
									Title="@LOC("Edit column")" OnClick="@(()=> _editColumn(context))"/>
								<FluentButton Appearance="@Appearance.Outline" OnClick="@(()=> _deleteColumn(context))" Title="@LOC("Delete column")">
									<FluentIcon Color="@Color.Error" Value="@TfConstants.DeleteIcon" />
								</FluentButton>
							</div>
						</td>
						<td class="tf-grid-td">
							<div>
								<div>@context.DbName</div>
								<div class="td-description">@context.SourceName</div>
							</div>
						</td>
						<td class="tf-grid-td">
							<div>
								<div>@context.DbType.Name</div>
								<div class="td-description">@context.SourceType</div>
							</div>
						</td>
						<td class="tf-grid-td">
							<div title="@context.CreatedOn.ToShortDateString() @context.CreatedOn.ToShortTimeString()">@context.CreatedOn.ToShortDateString()</div>
						</td>
						<td class="tf-grid-td">
							<div>
								<FluentStack>
									@if (context.IsNullable)
									{
										<FluentBadge Appearance="@Appearance.Accent">nullable</FluentBadge>
									}
									@if (context.IsUnique)
									{
										<FluentBadge Appearance="@Appearance.Accent">unique</FluentBadge>
									}
									@if (context.IsSearchable)
									{
										<FluentBadge Appearance="@Appearance.Accent">searchable [@context.PreferredSearchType.Name]</FluentBadge>
									}
									@if (context.IncludeInTableSearch)
									{
										<FluentBadge Appearance="@Appearance.Accent">global search</FluentBadge>
									}
									@if (context.IsSortable)
									{
										<FluentBadge Appearance="@Appearance.Accent">sortable</FluentBadge>
									}
									@if (context.AutoDefaultValue)
									{
										<FluentBadge Appearance="@Appearance.Accent">autogenerated</FluentBadge>
									}
								</FluentStack>
							</div>
						</td>
					</tr>
				}
			</tbody>
		</table>
	</div>

}

